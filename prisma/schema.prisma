generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                    String              @id @default(uuid())
  clerkUserId           String              @unique
  email                 String              @unique
  name                  String?
  imageUrl              String?
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  background            String?
  certificationInterest Boolean?            @default(false)
  companySizePref       String?
  educationLevel        String?
  internshipInterest    String[]
  locationPref          String?
  targetCompanies       String[]
  targetRole            String?
  skills                Json?
  industry              String?
  assessments           Assessment[]
  interviews            Interview[]
  jobAlerts             JobAlert[]
  progressMilestones    ProgressMilestone[]
  resume                Resume?
  roadmap               Roadmap?
  savedOpportunities    SavedOpportunity[]
  activities            UserActivity[]
  certifications        UserCertification[]
  userSkills            UserSkill[]
  weeklyInsights        WeeklyInsight[]

  @@index([clerkUserId])
  @@index([email])
  @@index([targetRole])
}

model Roadmap {
  id                 String    @id @default(cuid())
  userId             String    @unique
  title              String    @default("Personalized Career Roadmap")
  skillGapAnalysis   Json?
  weeklyPlan         Json[]
  progress           Float     @default(0.0)
  companyPrep        Json?
  certificationRecs  String[]
  internshipTimeline Json?
  currentWeek        Int       @default(1)
  completedWeeks     Int[]
  milestones         Json?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  lastAIGenerated    DateTime?
  user               User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model IndustryInsight {
  id                String    @id @default(cuid())
  industry          String
  targetRole        String?
  overview          String    @db.Text
  marketSize        String?
  growthRate        Float?
  averageSalary     String?
  trendingSkills    String[]
  emergingRoles     String[]
  topCompanies      String[]
  certifications    String[]
  learningResources String[]
  challenges        String[]
  opportunities     String[]
  aiInsights        Json?
  lastUpdated       DateTime  @default(now()) @updatedAt
  nextUpdate        DateTime?
  createdAt         DateTime  @default(now())

  @@unique([industry, targetRole])
  @@index([industry])
  @@index([targetRole])
}

model Resume {
  id                      String   @id @default(cuid())
  userId                  String   @unique
  content                 String?  @db.Text
  atsScore                Float?
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
  aiScore                 Float?
  companyFeedback         Json?
  fileName                String   @default("")
  fileSize                Int      @default(0)
  fileType                String   @default("")
  fileUrl                 String   @default("")
  missingKeywords         String[]
  optimizationSuggestions Json?
  optimizedCompanyUrl     String?
  optimizedGeneralUrl     String?
  strengths               String[]
  weaknesses              String[]
  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([aiScore])
}

model Assessment {
  id              String   @id @default(cuid())
  userId          String
  createdAt       DateTime @default(now())
  questions       Json[]
  certification   String?
  company         String?
  correctAnswers  Json?
  explanations    Json?
  recommendations Json?
  score           Float?
  timeTaken       Int?
  title           String
  totalQuestions  Int
  type            String
  userAnswers     Json?
  weakAreas       String[]
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@index([company])
  @@index([createdAt])
}

model Interview {
  id             String   @id @default(cuid())
  userId         String
  title          String
  type           String
  company        String?
  role           String?
  difficulty     String?
  questions      Json[]
  userResponses  Json?
  idealAnswers   Json?
  feedback       Json?
  score          Float?
  areasToImprove String[]
  duration       Int?
  isCompleted    Boolean  @default(false)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@index([company])
}

model Opportunity {
  id               String             @id @default(cuid())
  title            String
  type             String
  company          String?
  description      String
  isGSoC           Boolean            @default(false)
  gsocOrg          String?
  gsocTimeline     Json?
  isCertification  Boolean            @default(false)
  certProvider     String?
  examDate         DateTime?
  cost             Float?
  eligibility      String[]
  skillsRequired   String[]
  applicationOpen  DateTime?
  applicationClose DateTime?
  postedDate       DateTime           @default(now())
  applyLink        String
  resources        String[]
  savedByCount     Int                @default(0)
  savedByUsers     SavedOpportunity[]

  @@index([type])
  @@index([company])
  @@index([applicationClose])
  @@index([isGSoC])
  @@index([isCertification])
}

model SavedOpportunity {
  id            String      @id @default(cuid())
  userId        String
  opportunityId String
  status        String      @default("interested")
  appliedDate   DateTime?
  notes         String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  opportunity   Opportunity @relation(fields: [opportunityId], references: [id])
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, opportunityId])
  @@index([userId, status])
}

model UserCertification {
  id             String    @id @default(cuid())
  userId         String
  name           String
  provider       String
  status         String    @default("planned")
  studyMaterials String[]
  examDate       DateTime?
  cost           Float?
  roiAnalysis    Json?
  completionDate DateTime?
  certificateUrl String?
  score          String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([provider])
  @@index([status])
}

model UserActivity {
  id           String   @id @default(cuid())
  userId       String
  activityType String
  module       String
  details      Json?
  score        Float?
  metadata     Json?
  createdAt    DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([activityType])
  @@index([createdAt])
  @@index([userId, createdAt])
}

model ProgressMilestone {
  id           String    @id @default(cuid())
  userId       String
  title        String
  description  String
  type         String
  targetValue  Float
  currentValue Float     @default(0)
  isAchieved   Boolean   @default(false)
  achievedAt   DateTime?
  badge        String?
  xpReward     Int?
  createdAt    DateTime  @default(now())
  targetDate   DateTime?
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@index([isAchieved])
}

model JobAlert {
  id          String   @id @default(cuid())
  userId      String
  title       String
  company     String?
  matchScore  Float
  description String
  source      String
  sourceId    String?
  status      String   @default("new")
  isNotified  Boolean  @default(false)
  applyLink   String?
  detailsLink String?
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([matchScore])
  @@index([createdAt])
}

model WeeklyInsight {
  id              String   @id @default(cuid())
  userId          String
  title           String
  summary         String
  insights        Json?
  recommendations String[]
  weekStart       DateTime
  weekEnd         DateTime
  isViewed        Boolean  @default(false)
  createdAt       DateTime @default(now())
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, weekStart])
  @@index([userId])
  @@index([createdAt])
}

model UserSkill {
  id            String    @id @default(cuid())
  userId        String
  skill         String
  level         String
  category      String?
  confidence    Int?      @default(0)
  lastPracticed DateTime?
  resourcesUsed String[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, skill])
  @@index([userId])
  @@index([skill])
}
